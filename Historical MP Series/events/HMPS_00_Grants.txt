namespace = grants

grants.1 = {
	type = country_event
	placement = ROOT
	title = grants.1.t
	desc = grants.1.d
	flavor = grants.1.f

	event_image = {
		video = "unspecific_signed_contract"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"

	duration = 1
	
	trigger = {
		#triggered by diplo action
	}
	
	immediate = {
		trigger_event = {
			id = grants.3
			days = 0
		}
		random_country = {
			limit = {
				has_variable = grant_recipient
			}
			save_scope_as = grantee_scope
		}
	}
	
	option = {
		name = grants.1.a
		add_treasury = -250000
		remove_global_variable = grant_being_given
		trigger_event = {
			id = grants.3
			days = 0
		}
		scope:grantee_scope = {
			set_variable = grant_250
			remove_variable = grant_recipient
			trigger_event = {
				id = grants.2
				days = 0
				popup = yes
			}
		}
	}
	
	option = {
		name = grants.1.b
		trigger = {
			var:remaining_credit > 500000
		}
		add_treasury = -500000
		remove_global_variable = grant_being_given
		trigger_event = {
			id = grants.3
			days = 0
		}
		scope:grantee_scope = {
			set_variable = grant_500
			remove_variable = grant_recipient
			trigger_event = {
				id = grants.2
				days = 0
				popup = yes
			}
		}
	}
	
	option = {
		name = grants.1.c
		trigger = {
			var:remaining_credit > 1000000
		}
		add_treasury = -1000000
		remove_global_variable = grant_being_given
		trigger_event = {
			id = grants.3
			days = 0
		}
		scope:grantee_scope = {
			set_variable = grant_1000
			remove_variable = grant_recipient
			trigger_event = {
				id = grants.2
				days = 0
				popup = yes
			}
		}
	}
	
	option = {
		name = grants.1.e
		trigger = {
			var:remaining_credit > 2000000
		}
		add_treasury = -2000000
		remove_global_variable = grant_being_given
		trigger_event = {
			id = grants.3
			days = 0
		}
		scope:grantee_scope = {
			set_variable = grant_2000
			remove_variable = grant_recipient
			trigger_event = {
				id = grants.2
				days = 0
				popup = yes
			}
		}
	}
	
	option = {
		name = grants.1.g
		trigger = {
			var:remaining_credit > 4000000
		}
		add_treasury = -4000000
		remove_global_variable = grant_being_given
		trigger_event = {
			id = grants.3
			days = 0
		}
		scope:grantee_scope = {
			set_variable = grant_4000
			remove_variable = grant_recipient
			trigger_event = {
				id = grants.2
				days = 0
				popup = yes
			}
		}
	}
	
	option = {
		name = grants.1.h
		trigger = {
			var:remaining_credit > 8000000
		}
		add_treasury = -8000000
		remove_global_variable = grant_being_given
		trigger_event = {
			id = grants.3
			days = 0
		}
		scope:grantee_scope = {
			set_variable = grant_8000
			remove_variable = grant_recipient
			trigger_event = {
				id = grants.2
				days = 0
				popup = yes
			}
		}
	}
	
}

grants.2 = {
	type = country_event
	placement = ROOT
	title = grants.2.t
	desc = grants.2.d
	flavor = grants.2.f

	event_image = {
		video = "unspecific_signed_contract"
	}

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"
	
	duration = 3
	
	option = {
		name = grants.2.a
		if = {
			limit = {
				has_variable = grant_250
			}
			add_treasury = 250000
			remove_variable = grant_250
		}
		if = {
			limit = {
				has_variable = grant_500
			}
			add_treasury = 500000
			remove_variable = grant_500
		}
		if = {
			limit = {
				has_variable = grant_1000
			}
			add_treasury = 1000000
			remove_variable = grant_1000
		}
		if = {
			limit = {
				has_variable = grant_2000
			}
			add_treasury = 2000000
			remove_variable = grant_2000
		}
		if = {
			limit = {
				has_variable = grant_4000
			}
			add_treasury = 4000000
			remove_variable = grant_4000
		}
		if = {
			limit = {
				has_variable = grant_8000
			}
			add_treasury = 8000000
			remove_variable = grant_8000
		}
	}
}

grants.3 = {
	type = country_event
	hidden = yes
	
	immediate = {
		set_variable = {
			name = remaining_credit
			value = ROOT.credit
		}
		set_variable = {
			name = scaled_debt_var
			value = ROOT.scaled_debt
		}
		set_variable = {
			name = scaled_debt_percent
			value = 1
		}
		change_variable = {
			name = scaled_debt_percent
			subtract = var:scaled_debt_var
		}
		change_variable = {
			name = remaining_credit
			multiply = var:scaled_debt_percent
		}
	}
}